{% extends "layout/base.html" %}

{% block title %}Movimentos de Estoque{% endblock %}

{% block page_header %}
<div class="d-flex justify-content-between align-items-center mb-3">
  <div>
    <h2 class="page-title">Saidas e devolucoes</h2>
    <div class="text-muted">Movimentos do ciclo atual: {{ evento.nome }}</div>
  </div>
  <div class="d-flex gap-2">
    <a class="btn btn-secondary" href="{% url 'inventory:produtos_lista' %}">Produtos</a>
    <a class="btn btn-primary" href="{% url 'inventory:movimentacao_criar' %}">Novo movimento</a>
  </div>
</div>
{% endblock %}

{% block content %}
<div class="card mb-3">
  <div class="card-body">
    <form class="row g-2" method="get">
      <div class="col-md-4">
        <select class="form-select" name="tipo">
          <option value="">Todos os tipos</option>
          <option value="SAIDA" {% if filtros.tipo == 'SAIDA' %}selected{% endif %}>Saida</option>
          <option value="DEVOLUCAO" {% if filtros.tipo == 'DEVOLUCAO' %}selected{% endif %}>Devolucao</option>
        </select>
      </div>
      <div class="col-md-2"><button class="btn btn-secondary w-100" type="submit">Filtrar</button></div>
      <div class="col-md-2"><a class="btn btn-outline w-100" href="{% url 'inventory:movimentos_lista' %}">Limpar</a></div>
    </form>
  </div>
</div>

<div class="card">
  <div class="table-responsive">
    <table class="table card-table table-vcenter">
      <thead>
        <tr>
          <th>Data</th>
          <th>Tipo</th>
          <th>Produto</th>
          <th class="text-end">Quantidade</th>
          <th>Observacao</th>
          <th>Usuario</th>
        </tr>
      </thead>
      <tbody>
        {% for movimento in page_obj %}
          <tr>
            <td>{{ movimento.data|date:"d/m/Y" }}</td>
            <td>
              {% if movimento.tipo == 'SAIDA' %}
                <span class="badge bg-danger">Saida</span>
              {% else %}
                <span class="badge bg-success">Devolucao</span>
              {% endif %}
            </td>
            <td>{{ movimento.produto.nome }}</td>
            <td class="text-end">{{ movimento.quantidade }}</td>
            <td>{{ movimento.observacao|default:'-' }}</td>
            <td>{{ movimento.criado_por }}</td>
          </tr>
        {% empty %}
          <tr><td colspan="6">Nenhum movimento registrado.</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
  {% if page_obj.paginator.num_pages > 1 %}
  <div class="card-footer text-end">
    {% if page_obj.has_previous %}<a class="btn btn-outline" href="?{{ querystring }}&page={{ page_obj.previous_page_number }}">Anterior</a>{% endif %}
    {% if page_obj.has_next %}<a class="btn btn-outline" href="?{{ querystring }}&page={{ page_obj.next_page_number }}">Proxima</a>{% endif %}
  </div>
  {% endif %}
</div>
{% endblock %}
